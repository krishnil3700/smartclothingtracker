<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Wardrobe Insights</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <style>
        /* Card styling */
        .insight-card {
            background-color: #f0f4f8;
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .insight-card h3 {
            font-size: 20px;
            color: #333;
        }
        .insight-card p {
            font-size: 16px;
            color: #555;
        }
        .sleek-widget {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .last-item-card {
            background-color: #e3f2fd;
            border: 1px solid #90caf9;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">Smart Wardrobe Insights</h1>
<!-- Sleek Weather Widget -->
<div class="sleek-widget">
    <div id="weatherapi-weather-widget-3"></div>
    <script type='text/javascript' src='https://www.weatherapi.com/weather/widget.ashx?loc=1774765&wid=3&tu=1&div=weatherapi-weather-widget-3' async></script>
    <noscript><a href="https://www.weatherapi.com/weather/q/auckland-1774765" alt="Auckland weather">Auckland Weather Forecast</a></noscript>
</div>


        <!-- Insight Cards -->
        <div id="insightCards" class="mt-4"></div>

        <!-- Wardrobe Temperature and Humidity Card -->
        <div id="wardrobeConditions" class="insight-card">Loading wardrobe conditions...</div>

        <!-- Clothing Recommendation Based on Weather -->
        <div id="weatherRecommendation" class="insight-card">Loading clothing recommendation...</div>

        <!-- Last Clothing Item Added -->
        <div id="lastItemCard" class="last-item-card">Loading last added item...</div>
    </div>

    <script>
        // Fetch clothing and other field data insights from the Flask server
        async function fetchInsights() {
            try {
                const response = await fetch('/insights');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const data = await response.json();

                // Generate clothing insights and append them to the cards
                const clothingData = data.clothing_data;
                const mostWornItem = clothingData.most_worn;
                const mostWornBrand = clothingData.most_worn_brand;
                const leastWornItem = clothingData.least_worn;
                const descriptions = clothingData.clothing_descriptions;

                let insightsHtml = `
                    <div class="insight-card">
                        <h3>Most Worn Item</h3>
                        <p>You’ve worn your ${mostWornBrand} ${descriptions[0]} the most this week.</p>
                    </div>
                    <div class="insight-card">
                        <h3>Favourite Clothing color Worn This Week</h3>
                        <p>Your most worn clothing color this week is ${mostWornBrand}.</p>
                    </div>
                    <div class="insight-card">
                        <h3>Least Worn Item</h3>
                        <p>How about wearing your ${leastWornItem}? You haven’t worn it in a while!</p>
                    </div>
                `;

                // Insert the insights into the DOM
                document.getElementById('insightCards').innerHTML = insightsHtml;

                // Wardrobe environment alerts
                const temp = parseFloat(clothingData.wardrobe_temperature[0]);
                const humidity = parseFloat(clothingData.wardrobe_humidity[0]);
                let alertMessage = `Current temperature in your wardrobe is ${temp}°C and humidity is ${humidity}%. `;
                if (temp > 28) {
                    alertMessage += "It's too hot! Consider cooling down the wardrobe area.";
                }
                if (humidity > 70) {
                    alertMessage += "High humidity detected! Use a dehumidifier to protect your clothes.";
                }
                document.getElementById('wardrobeConditions').textContent = alertMessage;

                // Clothing recommendation based on weather
                let weatherRecommendation = `Today's temperature is ${temp}°C. `;
                if (temp > 25) {
                    weatherRecommendation += "It's warm! Consider wearing light clothing like a T-shirt.";
                } else if (temp < 15) {
                    weatherRecommendation += "It's cold! You might want to wear a jacket or sweater.";
                }
                document.getElementById('weatherRecommendation').textContent = weatherRecommendation;

                // Last clothing item added
                const lastItem = clothingData.last_item;
                let lastItemHtml = `
                    <h3>Last Clothing Item Added</h3>
                    <p><strong>ID:</strong> ${lastItem.entry_id || "No data"}</p>
                    <p><strong>Brand:</strong> ${lastItem.field2 || "No brand data"}</p>
                    <p><strong>Description:</strong> ${lastItem.field3 || "No description available"}</p>
                `;
                document.getElementById('lastItemCard').innerHTML = lastItemHtml;

            } catch (error) {
                console.error('Error fetching insights:', error);
                document.getElementById('insightCards').textContent = 'Error loading insights';
                document.getElementById('wardrobeConditions').textContent = 'Error loading wardrobe conditions';
                document.getElementById('weatherRecommendation').textContent = 'Error loading weather recommendation';
                document.getElementById('lastItemCard').textContent = 'Error loading last item data';
            }
        }

        // Fetch the insights when the page loads
        fetchInsights();
    </script>
</body>
</html>
